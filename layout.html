<!DOCTYPE html>
<html lang="en">
<head>
    <meta description="">
    <meta author="Stephen Funderburk">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Theatre Inventory</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/theatre-inventory.css">
</head>
<body>
    <nav>
        <a href="#" id="navView" class="active">View</a>
        <a href="#" id="navAdd">Add</a>
    </nav>

    <section id="pnlAdd" style="display:none;">
        <h1>Add Inventory</h1>

        <form action="POST" id="addInventory">
            <div class="addImage">
                <div class="upload">
                    <a href="#" id="btn_up_file"><i class="fa-solid fa-upload"></i></a>
                    <input type="file" accept="image/*" id="up_file" style="display:none;">
                </div>

                <div class="camera">
                    <a href="#" id="btn_up_camera"><i class="fa-solid fa-camera"></i></a>
                    <input type="file" accept="image/*" capture="camera" id="up_camera" style="display:none;">
                </div>
            </div>

            <p id="selectedFileName" class="note"></p>
            <input type="hidden" id="uploadType">

            <div class="mat-text">
                <!-- the css trick uses :not(:placeholder-shown) so the placeholder 
                    here has to be present to work, but is an empty space -->
                <input type="text" id="txtName" placeholder=" " required>
                <label for="txtName">Name</label>
                <span class="error-textbox">Name is required</span>
            </div>

            <div class="mat-text">
                <input type="text" id="txtSize" placeholder=" " required>
                <label for="txtSize">Size</label>
                <span class="error-textbox">Size is required</span>
            </div>

            <div class="mat-text">
                <input type="text" id="txtType" placeholder=" " required>
                <label for="txtType">Type</label>
                <span class="error-textbox">Type is required</span>
            </div>

            <div class="mat-text">
                <textarea name="txtTags" id="txtTags" placeholder=" " data-gramm="false" data-gramm_editor="false" data-enable-grammarly="false"></textarea>
                <label for="txtTags">Tags</label>
            </div>
            <p class="note">(Optional) Tags should be separated by a comma.</p>

            <div class="submitContainer">
                <div class="fa fa-check" id="submitDone"></div>
                <div class="fa fa-close" id="submitFailed"></div>
                <input type="submit" id="submitAdd" value="Submit">
            </div>
        </form>
    </section>

    <section id="pnlView">
        <h1>View Inventory</h1>
        <div id="fullImg" style="display:none;"></div>

        <input type="checkbox" id="cbFilterToggle">
        <label for="cbFilterToggle" id="lblFilterToggle"></label>
        <aside id="filter">
            <h2>Filter Inventory</h2>
            
            <div class="mat-text">
                <input type="text" id="txtFiltName" placeholder=" ">
                <label for="txtFiltName">Name</label>
            </div>
            
            <div class="mat-text">
                <input type="text" id="txtFiltSize" placeholder=" ">
                <label for="txtFiltSize">Size</label>
            </div>
            
            <div class="mat-text">
                <input type="text" id="txtFiltType" placeholder=" ">
                <label for="txtFiltType">Type</label>
            </div>
            
            <div class="mat-text">
                <input type="text" id="txtFiltTags" placeholder=" ">
                <label for="txtFiltTags">Tags</label>
            </div>

            <div style="text-align:center;">
                <label for="cbMatchAll" class="switch">
                    <input type="checkbox" id="cbMatchAll">
                    <i></i> 
                    <span></span>
                </label>
            </div>

            <div>
                <a href="layout.html" class="btn">Clear Filters</a>
                <a href="#" class="btn" id="applyFilters">Apply Filters</a>
            </div>
        </aside>

        <div id="itemsContainer"></div>
    </section>

    <ul id="notifications"></ul>


    <script>
        document.addEventListener("DOMContentLoaded", function(){
            const btnFileUpload = document.getElementById("btn_up_file");
            const btnCameraUpload = document.getElementById("btn_up_camera");
            const inputFileUpload = document.getElementById("up_file");
            const inputCameraUpload = document.getElementById("up_camera");
            const submitButton = document.getElementById("submitAdd");
            const submitDone = document.getElementById("submitDone");
            const submitFailed = document.getElementById("submitFailed");
            const theForm = document.getElementById("addInventory");

            btnFileUpload.addEventListener("click", function(e){ 
                e.preventDefault();
                inputFileUpload.click();
            });

            btnCameraUpload.addEventListener("click", function(e){ 
                e.preventDefault();
                inputCameraUpload.click(); 
            });

            inputFileUpload.addEventListener("change", function(){ updateFileName(this.files[0].name, "file"); });
            inputCameraUpload.addEventListener("change", function(){ updateFileName(this.files[0].name, "camera"); });


            // submit
            submitButton.addEventListener("click", function(e){
                e.preventDefault();
                this.disabled = true;
                this.classList.add("loading");
                
                setTimeout(function(){
                    submitButton.classList.add("hide-loading");
                    submitDone.classList.add("finish");
                }, 3000);

                setTimeout(function(){
                    submitButton.classList.remove("loading");
                    submitButton.classList.remove("hide-loading");
                    submitButton.disabled = false;
                    submitDone.classList.remove("finish");
                    submitFailed.classList.remove("finish");
                    theForm.reset();
                    document.getElementById("txtName").focus();
                }, 5000);
            });


            // nav
            const navAdd = document.getElementById("navAdd");
            const navView = document.getElementById("navView");
            const pnlAdd = document.getElementById("pnlAdd");
            const pnlView = document.getElementById("pnlView");
            navAdd.addEventListener("click", function(e){
                e.preventDefault();
                pnlAdd.style.display = "block";
                pnlView.style.display = "none";
                navAdd.classList.add("active");
                navView.classList.remove("active");
            });

            navView.addEventListener("click", function(e){
                e.preventDefault();
                pnlAdd.style.display = "none";
                pnlView.style.display = "block";
                navAdd.classList.remove("active");
                navView.classList.add("active");
            });


            // toast notifications
            const notifications = document.getElementById("notifications");
            const toastDetails = {
                timer: 5000,
                success: {
                    icon: "fa-circle-check",
                    text: "Success: Inventory item added."
                },
                error: {
                    icon: "fa-circle-xmark",
                    text: "Error: Problem with file upload."
                },
                warning: {
                    icon: "fa-triangle-exclamation",
                    text: "Warning: Something isn't right."
                },
                info: {
                    icon: "fa-circle-info",
                    text: "Info: Something you should know."
                }
            }

            const removeToast = (toast) => {
                toast.classList.add("hide");
                if (toast.timeoutId) clearTimeout(toast.timeoutId);
                setTimeout(() => toast.remove(), 500);
            }

            const createToast = (id) => {
                const {icon, text} = toastDetails[id];
                const toast = document.createElement("li");
                toast.className = `toast ${id}`;
                toast.innerHTML = `<div class="column"><i class="fa-solid ${icon}"></i><span>${text}</span></div><i class="fa-solid fa-xmark" onclick="removeToast(this.parentElement)"></i>`;
                notifications.appendChild(toast);
                toast.timeoutId = setTimeout(() => removeToast(toast), toastDetails.timer);
            }


            // view items
            let items = [];

            // simulated from db
            tags0 = "90s, Mean Girls";
            items[0] = {
                img: "dress.jpg",
                name: "Green Dress",
                size: "Small",
                type: "Dress",
                tagsString: tags0,
                tags: tags0.split(",").map(item => item.trim())
            };

            tags1 = "Boys, Men, Fancy";
            items[1] = {
                img: "dress_pants.jpg",
                name: "Dress Slacks",
                size: "Small",
                type: "Pants",
                tagsString: tags1,
                tags: tags1.split(",").map(item => item.trim())
            };

            tags2 = "Boys, Men, Fancy, 90s";
            items[2] = {
                img: "dress_pants.jpg",
                name: "Dress Slacks",
                size: "Medium",
                type: "Pants",
                tagsString: tags2,
                tags: tags2.split(",").map(item => item.trim())
            };

            loadItems(items);

            const applyFiltersButton = document.getElementById("applyFilters");
            applyFiltersButton.addEventListener("click", function(e){
                e.preventDefault();

                const _name = document.getElementById("txtFiltName").value.trim();
                const _size = document.getElementById("txtFiltSize").value.trim();
                const _type = document.getElementById("txtFiltType").value.trim();
                const _tags = document.getElementById("txtFiltTags").value.trim();

                if (_name == "" && _size == "" && _type == "" && _tags == "") {
                    document.getElementById("cbFilterToggle").checked = false;
                    return;
                }

                let filters = {
                    name: _name,
                    size: _size,
                    type: _type,
                    tags: _tags.toLowerCase().split(",").map(tag => tag.trim())
                };

                if (filters.tags.length == 1 && filters.tags[0].trim() == "") {
                    filters.tags = null;
                }
                
                loadItems(items, filters);
                document.getElementById("cbFilterToggle").checked = false;
            });
        });

        function updateFileName(fn, type) {
            if (fn == "") return;
            document.getElementById("selectedFileName").innerHTML = "<strong>Selected Image:</strong> " + fn;
            document.getElementById("uploadType").value = type;
        }


        // full size image
        const fullDiv = document.getElementById("fullImg");
        fullDiv.addEventListener("click", function(){ fullDiv.style.display = "none"; });

        function fullScale(img) {
            fullDiv.style.display = "block";
            fullDiv.style.backgroundImage = `url("${img}")`;
        }


        function loadItems(items, filters={}) {
            const itemsContainer = document.getElementById("itemsContainer");
            itemsContainer.innerHTML = "";

            let matchAll = document.getElementById("cbMatchAll").checked;

            items.forEach(item => {
                // check filters
                if (Object.keys(filters).length > 0) {
                    let matchCount = 0;
                    let blanks = 0;

                    if (filters.name != "") {
                        if (item.name.toLowerCase() == filters.name.toLowerCase()) { matchCount++; }
                    } else {
                        blanks++;
                    }

                    if (filters.size != "") {
                        if (item.size.toLowerCase() == filters.size.toLowerCase()) { matchCount++; }
                    } else {
                        blanks++;
                    }
                    
                    if (filters.type != "") {
                        if (item.type.toLowerCase() == filters.type.toLowerCase()) { matchCount++; }
                    } else {
                        blanks++;
                    }

                    if (filters.tags == null || filters.tags.length == 0) {
                        blanks++;
                    } else {
                        const set = new Set(item.tags.map(tag => tag.toLowerCase()));
                        const matches = filters.tags.filter(t => set.has(t));
                        if (matches.length > 0) { matchCount++; }
                    }

                    if (matchCount == 0) { return; }
                    if (matchAll && matchCount != (4 - blanks)) { return; }
                }

                const box = document.createElement("div");
                box.classList.add("item");

                const divImage = document.createElement("div");
                const image = document.createElement("img");
                image.src = "img/costume/" + item.img;
                image.alt = item.name;
                image.addEventListener("click", () => { fullScale(image.src) });
                divImage.appendChild(image);
                box.appendChild(divImage);

                const divDetails = document.createElement("div");
                const h3Name = document.createElement("h3");
                h3Name.innerText = item.name;
                divDetails.appendChild(h3Name);

                const pSize = document.createElement("p");
                pSize.innerText = item.size;
                divDetails.appendChild(pSize);

                const pType = document.createElement("p");
                pType.innerText = item.type;
                divDetails.appendChild(pType);

                const pTags = document.createElement("p");
                pTags.innerText = item.tagsString;
                divDetails.appendChild(pTags);
                
                box.appendChild(divDetails);

                const divButtons = document.createElement("div");
                const editButton = document.createElement("a");
                editButton.href = "#";
                editButton.classList.add("btn");
                editButton.classList.add("edit");
                editButton.innerText = "Edit";
                const deleteButton = document.createElement("a");
                deleteButton.href = "#";
                deleteButton.classList.add("btn");
                deleteButton.classList.add("delete");
                deleteButton.innerText = "Delete";
                divButtons.appendChild(editButton);
                divButtons.appendChild(deleteButton);
                box.appendChild(divButtons);

                itemsContainer.appendChild(box);
            });
        }
    </script>
</body>
</html>